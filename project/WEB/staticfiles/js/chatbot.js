document.addEventListener("DOMContentLoaded", function () {
	// 채팅 관련 요소들
	const chatIcon = document.getElementById("chat-icon");
	const chatWindow = document.getElementById("chat-window");
	const closeChat = document.getElementById("close-chat");
	const chatForm = document.getElementById("chat-form");
	const messageInput = document.getElementById("message-input");
	const chatMessages = document.getElementById("chat-messages");
	const powerModeToggle = document.getElementById("power-mode-toggle");

	// 챗봇 아이콘 SVG 정의
	const BOT_ICON = `
        <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
			<path d="M24 12.8937C24 19.5227 18.6248 24.895 12.0071 24.895C5.37341 24.895 0 19.5227 0 12.8937C0 6.27266 5.37341 0.895019 12.0071 0.895019C18.6248 0.895019 24 6.27266 24 12.8937Z" fill="white"/>
            <path d="M12.0142 24.3306C18.3199 24.3306 23.4372 19.2117 23.4372 12.8973C23.4372 6.58381 18.3199 1.46494 12.0124 1.46494C5.6969 1.46494 0.58139 6.58381 0.58139 12.8973C0.58139 19.2144 5.6969 24.3306 12.0142 24.3306Z" fill="#0088CC"/>
            <mask id="mask0_2_825" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="1" width="24" height="24">
            <path d="M0.58226 12.9863C0.58226 19.2965 5.69689 24.4124 12.014 24.4124C18.3178 24.4124 23.4359 19.2948 23.4359 12.9863C23.4359 6.67351 18.3178 1.56033 12.0113 1.56033C5.69689 1.56033 0.58226 6.67351 0.58226 12.9863Z" fill="white"/>
            </mask>
            <g mask="url(#mask0_2_825)">
            <path d="M12.1138 18.4947C17.1416 18.4947 21.4419 19.8991 23.2939 21.8855C23.9035 20.4714 24.2438 18.9005 24.2438 17.2632C24.2438 10.7014 18.8101 5.39327 12.1138 5.39327C5.42544 5.39327 -0.011734 10.7049 -0.011734 17.2676C-0.011734 18.9041 0.332077 20.4697 0.942607 21.8855C2.78837 19.8991 7.09399 18.4947 12.1138 18.4947Z" fill="#0088CC"/>
            <path d="M12.1121 18.5075C17.1275 18.5075 21.4172 19.9004 23.2629 21.8708C23.8717 20.4683 24.212 18.9098 24.212 17.2857C24.212 10.7762 18.7916 5.49469 12.1121 5.49469C5.44149 5.49469 0.0176086 10.7806 0.0176086 17.2893C0.0176086 18.9133 0.360533 20.4665 0.970177 21.8708C2.81152 19.9004 7.10649 18.5075 12.1121 18.5075Z" fill="#0089CD"/>
            <path d="M12.111 18.5201C17.1131 18.5201 21.3921 19.9023 23.2335 21.856C23.8413 20.4649 24.1798 18.9188 24.1798 17.3081C24.1798 10.8517 18.7737 5.59675 12.111 5.59675C5.45719 5.59675 0.0474854 10.8561 0.0474854 17.3116C0.0474854 18.9233 0.388638 20.4631 0.997396 21.856C2.83342 19.9023 7.11776 18.5201 12.111 18.5201Z" fill="#008BCE"/>
            <path d="M12.1094 18.5329C17.0982 18.5329 21.3666 19.9027 23.2026 21.8413C23.8096 20.4618 24.1472 18.9281 24.1472 17.3297C24.1472 10.9265 18.7552 5.69729 12.1094 5.69729C5.47332 5.69729 0.0769043 10.9301 0.0769043 17.3333C0.0769043 18.9316 0.417171 20.46 1.02416 21.8413C2.85575 19.9027 7.12857 18.5329 12.1094 18.5329Z" fill="#008CCF"/>
            <path d="M12.1082 18.5456C17.0846 18.5456 21.3415 19.9047 23.1731 21.8274C23.7783 20.4594 24.115 18.9372 24.115 17.353C24.115 11.0021 18.7363 5.79944 12.1082 5.79944C5.48895 5.79944 0.10672 11.0056 0.10672 17.3557C0.10672 18.9417 0.4461 20.4576 1.05131 21.8274C2.87847 19.9047 7.14066 18.5456 12.1082 18.5456Z" fill="#008ED0"/>
            <path d="M12.1064 18.5591C17.0695 18.5591 21.3158 19.9058 23.1421 21.8125C23.7464 20.456 24.0822 18.9471 24.0822 17.3754C24.0822 11.0776 18.7177 5.90061 12.1064 5.90061C5.50403 5.90061 0.135971 11.0811 0.135971 17.378C0.135971 18.9507 0.474465 20.4551 1.07879 21.8125C2.90064 19.9058 7.15219 18.5591 12.1064 18.5591Z" fill="#0090D1"/>
            <path d="M12.1043 18.5716C17.055 18.5716 21.2906 19.9069 23.1116 21.7976C23.715 20.4526 24.0491 18.9562 24.0491 17.3977C24.0491 11.1531 18.6988 6.00179 12.1043 6.00179C5.51965 6.00179 0.164886 11.1566 0.164886 17.4003C0.164886 18.9597 0.502495 20.4518 1.10594 21.7976C2.92335 19.9069 7.1625 18.5716 12.1043 18.5716Z" fill="#0091D3"/>
            <path d="M12.1026 18.5842C17.04 18.5842 21.265 19.9079 23.0806 21.7827C23.6832 20.4493 24.0163 18.9661 24.0163 17.42C24.0163 11.2277 18.6802 6.10385 12.1026 6.10385C5.53474 6.10385 0.194153 11.2312 0.194153 17.4226C0.194153 18.9696 0.530875 20.4484 1.13343 21.7827C2.94553 19.9079 7.17404 18.5842 12.1026 18.5842Z" fill="#0093D4"/>
            <path d="M12.1013 18.597C17.0263 18.597 21.2398 19.9092 23.0501 21.7681C23.6518 20.4461 23.985 18.9754 23.985 17.4417C23.985 11.3034 18.6621 6.20527 12.1013 6.20527C5.5512 6.20527 0.223907 11.306 0.223907 17.4452C0.223907 18.9789 0.559744 20.4453 1.16053 21.7681C2.96819 19.9092 7.18608 18.597 12.1013 18.597Z" fill="#0095D5"/>
            <path d="M12.0996 18.6101C17.0113 18.6101 21.215 19.9108 23.02 21.7537C23.6199 20.4433 23.9522 18.9849 23.9522 17.4654C23.9522 11.3785 18.6444 6.30604 12.0996 6.30604C5.56715 6.30604 0.253143 11.382 0.253143 17.4671C0.253143 18.9884 0.588979 20.4424 1.18799 21.7537C2.99034 19.9108 7.19759 18.6101 12.0996 18.6101Z" fill="#0097D6"/>
            <path d="M12.0979 18.6224C16.9963 18.6224 21.1893 19.9125 22.9899 21.7385C23.588 20.4396 23.9195 18.9937 23.9195 17.4866C23.9195 11.4537 18.6249 6.40698 12.0979 6.40698C5.58228 6.40698 0.282455 11.4564 0.282455 17.4892C0.282455 18.9963 0.616519 20.4387 1.21464 21.7385C3.01345 19.9125 7.20829 18.6224 12.0979 18.6224Z" fill="#0099D8"/>
            <path d="M12.0961 18.635C16.983 18.635 21.1637 19.9135 22.9598 21.7236C23.557 20.4363 23.8867 19.0036 23.8867 17.5089C23.8867 11.5283 18.6063 6.50815 12.0961 6.50815C5.59824 6.50815 0.311707 11.5318 0.311707 17.5106C0.311707 19.0062 0.644884 20.4354 1.24212 21.7236C3.03472 19.9135 7.21982 18.635 12.0961 18.635Z" fill="#009AD9"/>
            <path d="M12.0948 18.6479C16.9685 18.6479 21.1385 19.9149 22.9293 21.71C23.5257 20.4332 23.8544 19.0129 23.8544 17.5315C23.8544 11.6041 18.5883 6.61054 12.0948 6.61054C5.61383 6.61054 0.341476 11.6068 0.341476 17.5333C0.341476 19.0156 0.673768 20.4332 1.26923 21.71C3.0574 19.9149 7.23187 18.6479 12.0948 18.6479Z" fill="#009CDA"/>
            <path d="M12.0935 18.6611C16.9538 18.6611 21.1132 19.9166 22.8987 21.6948C23.4942 20.4305 23.8221 19.0226 23.8221 17.5545C23.8221 11.6802 18.5701 6.71236 12.0935 6.71236C5.63022 6.71236 0.371155 11.6829 0.371155 17.5563C0.371155 19.0253 0.703446 20.4305 1.29625 21.6948C3.08088 19.9166 7.24294 18.6611 12.0935 18.6611Z" fill="#009EDB"/>
            <path d="M12.0918 18.6742C16.9388 18.6742 21.0876 19.9173 22.8678 21.6804C23.4623 20.4276 23.7893 19.0321 23.7893 17.5773C23.7893 11.7553 18.5506 6.81314 12.0918 6.81314C5.64531 6.81314 0.400421 11.7571 0.400421 17.5782C0.400421 19.0339 0.73094 20.4276 1.32375 21.6804C3.10217 19.9173 7.25449 18.6742 12.0918 18.6742Z" fill="#00A0DC"/>
            <path d="M12.0901 18.6865C16.9247 18.6865 21.0619 19.919 22.8377 21.6653C23.4305 20.4231 23.7566 19.0409 23.7566 17.5985C23.7566 11.8306 18.5321 6.91407 12.0901 6.91407C5.66044 6.91407 0.429733 11.8323 0.429733 17.6003C0.429733 19.0427 0.759367 20.4231 1.3504 21.6653C3.12528 19.919 7.26608 18.6865 12.0901 18.6865Z" fill="#00A2DE"/>
            <path d="M12.0883 18.6993C16.9096 18.6993 21.0371 19.9194 22.8076 21.6506C23.3995 20.42 23.7247 19.0502 23.7247 17.6211C23.7247 11.9054 18.5135 7.01549 12.0883 7.01549C5.67639 7.01549 0.458969 11.9072 0.458969 17.6219C0.458969 19.052 0.787716 20.4209 1.37787 21.6506C3.14743 19.9194 7.2767 18.6993 12.0883 18.6993Z" fill="#00A4DF"/>
            <path d="M12.087 18.7119C16.8951 18.7119 21.0119 19.9213 22.7771 21.6357C23.3672 20.4175 23.6924 19.0601 23.6924 17.6434C23.6924 11.9809 18.4954 7.11755 12.087 7.11755C5.69196 7.11755 0.488724 11.9826 0.488724 17.6443C0.488724 19.0619 0.816584 20.4175 1.40496 21.6357C3.17009 19.9213 7.28873 18.7119 12.087 18.7119Z" fill="#00A6E0"/>
            <path d="M12.0857 18.7251C16.8813 18.7251 20.9867 19.9229 22.7465 21.6223C23.3358 20.4138 23.6601 19.0697 23.6601 17.6663C23.6601 12.0569 18.4763 7.2193 12.0857 7.2193C5.70837 7.2193 0.517532 12.0587 0.517532 17.6672C0.517532 19.0715 0.844507 20.4147 1.43288 21.6223C3.1927 19.9229 7.30071 18.7251 12.0857 18.7251Z" fill="#00A8E2"/>
            <path d="M12.0839 18.738C16.8663 18.738 20.9619 19.9235 22.7164 21.6069C23.3048 20.4108 23.6264 19.0791 23.6264 17.6881C23.6264 12.131 18.4577 7.31999 12.0839 7.31999C5.72344 7.31999 0.546783 12.1328 0.546783 17.689C0.546783 19.0809 0.873759 20.4117 1.45948 21.6069C3.21486 19.9235 7.31135 18.738 12.0839 18.738Z" fill="#00AAE3"/>
            <path d="M12.0822 18.7507C16.8522 18.7507 20.9354 19.9255 22.6863 21.593C23.2729 20.4075 23.5946 19.0883 23.5946 17.7114C23.5946 12.2066 18.4401 7.42126 12.0822 7.42126C5.73946 7.42126 0.576981 12.2084 0.576981 17.7114C0.576981 19.09 0.902184 20.4084 1.48702 21.593C3.23708 19.9255 7.32294 18.7507 12.0822 18.7507Z" fill="#00ABE4"/>
            <path d="M12.0805 18.7637C16.8371 18.7637 20.9106 19.9261 22.6553 21.5776C23.2419 20.4046 23.5627 19.0977 23.5627 17.7332C23.5627 12.2825 18.4206 7.52283 12.0805 7.52283C5.75455 7.52283 0.606247 12.2834 0.606247 17.7332C0.606247 19.0986 0.930564 20.4054 1.51362 21.5776C3.26015 19.9261 7.33449 18.7637 12.0805 18.7637Z" fill="#00ADE5"/>
            <path d="M12.0793 18.7763C16.8235 18.7763 20.8854 19.9281 22.6249 21.5637C23.2106 20.4013 23.5296 19.1077 23.5296 17.7565C23.5296 12.3572 18.4026 7.62498 12.0793 7.62498C5.77017 7.62498 0.636047 12.3589 0.636047 17.7556C0.636047 19.1086 0.959477 20.4022 1.54165 21.5637C3.28197 19.9281 7.34568 18.7763 12.0793 18.7763Z" fill="#00B0E7"/>
            <path d="M12.0775 18.7888C16.8085 18.7888 20.8598 19.9291 22.5948 21.5479C23.1787 20.3978 23.4968 19.1166 23.4968 17.7779C23.4968 12.4326 18.384 7.72607 12.0775 7.72607C5.78613 7.72607 0.665298 12.4334 0.665298 17.777C0.665298 19.1175 0.987843 20.3987 1.56825 21.5479C3.30502 19.9291 7.3572 18.7888 12.0775 18.7888Z" fill="#00B2E8"/>
            <path d="M12.0758 18.8019C16.7944 18.8019 20.835 19.9298 22.5647 21.5334C23.1469 20.3949 23.465 19.1262 23.465 17.8007C23.465 12.5076 18.3654 7.82684 12.0758 7.82684C5.80215 7.82684 0.694611 12.5085 0.694611 17.7998C0.694611 19.127 1.01627 20.3958 1.59579 21.5334C3.32636 19.9298 7.3688 18.8019 12.0758 18.8019Z" fill="#05B4E9"/>
            <path d="M12.0744 18.8144C16.7797 18.8144 20.8088 19.9317 22.5341 21.5186C23.1154 20.3915 23.4326 19.1352 23.4326 17.823C23.4326 12.5831 18.3472 7.9289 12.0744 7.9289C5.81674 7.9289 0.724258 12.584 0.724258 17.8221C0.724258 19.1361 1.04503 20.3933 1.62277 21.5186C3.3498 19.9317 7.37983 18.8144 12.0744 18.8144Z" fill="#13B6EB"/>
            <path d="M12.0728 18.8275C16.7647 18.8275 20.7841 19.9333 22.5032 21.5042C23.0845 20.3887 23.3999 19.1447 23.3999 17.8458C23.3999 12.6591 18.3287 8.02968 12.0728 8.02968C5.83279 8.02968 0.753601 12.6591 0.753601 17.8449C0.753601 19.1456 1.07349 20.3904 1.64946 21.5042C3.37206 19.9333 7.39145 18.8275 12.0728 18.8275Z" fill="#1DB8EC"/>
            <path d="M12.0715 18.8403C16.7501 18.8403 20.7589 19.9346 22.4735 21.4895C23.053 20.3855 23.3676 19.154 23.3676 17.8684C23.3676 12.7339 18.3106 8.13199 12.0715 8.13199C5.8492 8.13199 0.782425 12.7348 0.782425 17.8666C0.782425 19.1549 1.10142 20.3873 1.6774 21.4895C3.39468 19.9346 7.40344 18.8403 12.0715 18.8403Z" fill="#24BBED"/>
            <path d="M12.0697 18.8534C16.736 18.8534 20.7332 19.9361 22.4425 21.4751C23.0211 20.3826 23.3348 19.1644 23.3348 17.8903C23.3348 12.8099 18.2911 8.23276 12.0697 8.23276C5.86428 8.23276 0.812561 12.8099 0.812561 17.8894C0.812561 19.1644 1.13068 20.3844 1.70399 21.4751C3.41684 19.9361 7.41497 18.8534 12.0697 18.8534Z" fill="#2BBDEE"/>
            <path d="M12.068 18.866C16.721 18.866 20.7076 19.9363 22.4124 21.4602C22.9893 20.3793 23.3021 19.1725 23.3021 17.9126C23.3021 12.8845 18.2725 8.33394 12.068 8.33394C5.88028 8.33394 0.841858 12.8845 0.841858 17.9108C0.841858 19.1734 1.1582 20.3802 1.73151 21.4602C3.43905 19.9363 7.42566 18.866 12.068 18.866Z" fill="#2DBFF0"/>
            <path d="M12.0667 18.8792C16.7072 18.8792 20.6823 19.938 22.3828 21.4451C22.9579 20.3757 23.2698 19.1822 23.2698 17.9356C23.2698 12.9597 18.2544 8.43576 12.0667 8.43576C5.89581 8.43576 0.871567 12.9606 0.871567 17.9338C0.871567 19.1822 1.18791 20.3774 1.75856 21.4451C3.46167 19.938 7.43765 18.8792 12.0667 18.8792Z" fill="#32C2F2"/>
            <path d="M12.065 18.8916C16.6923 18.8916 20.6576 19.9398 22.3518 21.4309C22.926 20.3721 23.2371 19.192 23.2371 17.9577C23.2371 13.0351 18.2359 8.53678 12.065 8.53678C5.91183 8.53678 0.900879 13.0351 0.900879 17.9551C0.900879 19.192 1.21545 20.3748 1.7861 21.4309C3.48389 19.9398 7.44924 18.8916 12.065 18.8916Z" fill="#35C5F4"/>
            <path d="M12.065 18.9211C16.686 18.9211 20.6461 19.9622 22.3376 21.4436C22.911 20.3919 23.222 19.2188 23.222 17.9935C23.222 13.1027 18.2279 8.63099 12.065 8.63099C5.91979 8.63099 0.915924 13.1027 0.915924 17.9908C0.915924 19.2188 1.23049 20.3946 1.80026 21.4436C3.49628 19.9622 7.45542 18.9211 12.065 18.9211Z" fill="#42C7F4"/>
            <path d="M12.065 18.95C16.6799 18.95 20.6346 19.984 22.3235 21.4565C22.8959 20.411 23.2069 19.2459 23.2069 18.0277C23.2069 13.1697 18.219 8.72366 12.065 8.72366C5.92779 8.72366 0.931015 13.1697 0.931015 18.0259C0.931015 19.2468 1.24558 20.4137 1.81358 21.4565C3.50694 19.984 7.46165 18.95 12.065 18.95Z" fill="#4BC8F5"/>
            <path d="M12.065 18.9791C16.6737 18.9791 20.623 20.0069 22.3102 21.4688C22.8809 20.4304 23.1919 19.2742 23.1919 18.0639C23.1919 13.2369 18.2102 8.81659 12.065 8.81659C5.93576 8.81659 0.946075 13.2369 0.946075 18.0612C0.946075 19.2742 1.25976 20.4322 1.82776 21.4697C3.51757 20.0069 7.46785 18.9791 12.065 18.9791Z" fill="#54CAF5"/>
            <path d="M12.065 19.0079C16.6674 19.0079 20.6115 20.0286 22.296 21.4817C22.8658 20.4495 23.1768 19.3012 23.1768 18.0989C23.1768 13.3038 18.2013 8.91007 12.065 8.91007C5.9437 8.91007 0.961105 13.3038 0.961105 18.0962C0.961105 19.3012 1.27479 20.4513 1.84101 21.4817C3.52905 20.0286 7.47402 19.0079 12.065 19.0079Z" fill="#5DCCF5"/>
            <path d="M12.0654 19.0375C16.6617 19.0375 20.5996 20.052 22.2823 21.4944C22.8512 20.4693 23.1613 19.329 23.1613 18.1337C23.1613 13.3705 18.1938 9.00339 12.0654 9.00339C5.95305 9.00339 0.976654 13.3705 0.976654 18.1329C0.976654 19.329 1.28945 20.471 1.85568 21.4944C3.54106 20.052 7.48071 19.0375 12.0654 19.0375Z" fill="#64CDF6"/>
            <path d="M12.065 19.0663C16.655 19.0663 20.5885 20.0737 22.2676 21.5063C22.8365 20.4883 23.1467 19.356 23.1467 18.1696C23.1467 13.4374 18.1844 9.09598 12.065 9.09598C5.95966 9.09598 0.991241 13.4374 0.991241 18.167C0.991241 19.356 1.30404 20.4901 1.86849 21.5063C3.5521 20.0737 7.48643 19.0663 12.065 19.0663Z" fill="#6BCFF6"/>
            <path d="M12.0646 19.0952C16.6475 19.0952 20.5765 20.0964 22.2539 21.5184C22.8211 20.5075 23.1312 19.3831 23.1312 18.2047C23.1312 13.5044 18.1761 9.18866 12.0646 9.18866C5.96812 9.18866 1.00679 13.5044 1.00679 18.2021C1.00679 19.3831 1.3187 20.5092 1.88227 21.5193C3.56322 20.0964 7.49223 19.0952 12.0646 19.0952Z" fill="#73D0F6"/>
            <path d="M12.065 19.1247C16.6426 19.1247 20.5654 20.1188 22.2402 21.532C22.8064 20.5272 23.1166 19.41 23.1166 18.2396C23.1166 13.5712 18.1676 9.28287 12.065 9.28287C5.97652 9.28287 1.02139 13.5721 1.02139 18.2378C1.02139 19.4109 1.3333 20.529 1.89598 21.532C3.57516 20.1188 7.49886 19.1247 12.065 19.1247Z" fill="#79D2F7"/>
            <path d="M12.0654 19.1538C16.636 19.1538 20.5543 20.1417 22.2255 21.5452C22.7918 20.5466 23.101 19.4382 23.101 18.2758C23.101 13.6393 18.1592 9.37579 12.0654 9.37579C5.98491 9.37579 1.03687 13.6393 1.03687 18.2731C1.03687 19.4391 1.34878 20.5484 1.91057 21.5452C3.58621 20.1417 7.50547 19.1538 12.0654 19.1538Z" fill="#7FD3F7"/>
            <path d="M12.0654 19.1827C16.6298 19.1827 20.542 20.1635 22.2123 21.5572C22.7759 20.5667 23.086 19.4645 23.086 18.3109C23.086 13.7054 18.1512 9.46847 12.0654 9.46847C5.99292 9.46847 1.05197 13.7063 1.05197 18.3082C1.05197 19.4653 1.363 20.5675 1.9239 21.5581C3.59777 20.1635 7.51172 19.1827 12.0654 19.1827Z" fill="#86D5F7"/>
            <path d="M12.065 19.2117C16.6231 19.2117 20.5309 20.1864 22.1976 21.5694C22.7612 20.5851 23.0705 19.4926 23.0705 18.3461C23.0705 13.7725 18.1419 9.56219 12.065 9.56219C6.00044 9.56219 1.06657 13.7734 1.06657 18.3435C1.06657 19.4926 1.3776 20.5868 1.93762 21.5703C3.60882 20.1864 7.51746 19.2117 12.065 19.2117Z" fill="#8CD7F8"/>
            <path d="M12.065 19.2409C16.6169 19.2409 20.5193 20.2084 22.1843 21.5826C22.7461 20.6053 23.0554 19.52 23.0554 18.3814C23.0554 13.8398 18.1339 9.656 12.065 9.656C6.00928 9.656 1.08162 13.8406 1.08162 18.3788C1.08162 19.5209 1.39264 20.6062 1.95178 21.5835C3.62033 20.2084 7.52364 19.2418 12.065 19.2409Z" fill="#93D9F8"/>
            <path d="M12.0658 19.2702C16.6106 19.2702 20.5078 20.2306 22.1701 21.5951C22.7319 20.624 23.0403 19.5466 23.0403 18.4169C23.0403 13.9071 18.125 9.7482 12.0658 9.7482C6.01808 9.7482 1.0975 13.908 1.0975 18.4143C1.0975 19.5475 1.40764 20.6258 1.96589 21.5959C3.63089 20.2306 7.53067 19.2711 12.0658 19.2702Z" fill="#98DBF8"/>
            <path d="M12.065 19.2992C16.6045 19.2992 20.4963 20.2534 22.156 21.6073C22.7169 20.6433 23.0253 19.5748 23.0253 18.4513C23.0253 13.9743 18.1162 9.84192 12.065 9.84192C6.02524 9.84192 1.11264 13.9752 1.11264 18.4504C1.11264 19.5756 1.42189 20.6451 1.97926 21.6082C3.64249 20.2534 7.53606 19.3001 12.065 19.2992Z" fill="#9EDCF9"/>
            <path d="M12.065 19.3281C16.5974 19.3281 20.4848 20.2752 22.1418 21.6202C22.701 20.6624 23.0102 19.6019 23.0102 18.4873C23.0102 14.0413 18.1074 9.9346 12.065 9.9346C6.03324 9.9346 1.12685 14.0421 1.12685 18.4846C1.12685 19.6028 1.4361 20.6642 1.99258 21.6211C3.65403 20.2752 7.54229 19.329 12.065 19.3281Z" fill="#A4DEF9"/>
            <path d="M12.0654 19.3576C16.5917 19.3576 20.4728 20.2986 22.1281 21.6329C22.6863 20.6822 22.9947 19.6296 22.9947 18.523C22.9947 14.108 18.0998 10.0279 12.0654 10.0279C6.04164 10.0279 1.14233 14.1089 1.14233 18.5203C1.14233 19.6305 1.45159 20.6831 2.00718 21.6338C3.66598 20.2986 7.54891 19.3585 12.0654 19.3576Z" fill="#AAE0FA"/>
            <path d="M12.065 19.3868C16.5859 19.3868 20.4618 20.3206 22.1143 21.6452C22.6717 20.7016 22.9792 19.657 22.9792 18.5583C22.9792 14.1752 18.0914 10.1208 12.065 10.1208C6.05005 10.1208 1.15784 14.177 1.15784 18.5557C1.15784 19.6579 1.4662 20.7025 2.02091 21.647C3.67705 20.3206 7.55555 19.3876 12.065 19.3868Z" fill="#AFE2FA"/>
            <path d="M12.065 19.4156C16.5797 19.4156 20.4503 20.3432 22.1002 21.658C22.6558 20.7215 22.9651 19.684 22.9651 18.5933C22.9651 14.2421 18.0826 10.2143 12.065 10.2143C6.05807 10.2143 1.17294 14.243 1.17294 18.5907C1.17294 19.6849 1.48131 20.7224 2.03513 21.6589C3.68861 20.3432 7.56091 19.4164 12.065 19.4156Z" fill="#B4E4FA"/>
            <path d="M12.0654 19.4444C16.5731 19.4444 20.4392 20.3659 22.0864 21.6701C22.6411 20.7398 22.9495 19.7111 22.9495 18.6284C22.9495 14.3091 18.0741 10.307 12.0654 10.307C6.06645 10.307 1.18842 14.3109 1.18842 18.6267C1.18842 19.712 1.4959 20.7407 2.04794 21.6719C3.69965 20.3659 7.56752 19.4453 12.0654 19.4444Z" fill="#BBE6FB"/>
            <path d="M12.0654 19.474C16.5668 19.474 20.4267 20.3883 22.0714 21.6837C22.6261 20.7596 22.9344 19.738 22.9344 18.6633C22.9344 14.3767 18.0653 10.4003 12.0654 10.4003C6.07441 10.4003 1.20346 14.3776 1.20346 18.6615C1.20346 19.7398 1.51006 20.7605 2.0621 21.6846C3.71115 20.3883 7.57371 19.4749 12.0654 19.474Z" fill="#C0E8FB"/>
            <path d="M12.065 19.5031C16.5602 19.5031 20.4157 20.4104 22.0577 21.696C22.6106 20.779 22.919 19.7662 22.919 18.6995C22.919 14.444 18.0569 10.4941 12.065 10.4941C6.08286 10.4941 1.21811 14.4449 1.21811 18.6968C1.21811 19.7671 1.5247 20.7798 2.07586 21.6978C3.72226 20.4104 7.58038 19.504 12.065 19.5031Z" fill="#C5EAFB"/>
            <path d="M12.065 19.5326C16.554 19.5326 20.4042 20.4337 22.0443 21.7087C22.5964 20.7987 22.9039 19.7931 22.9039 18.7352C22.9039 14.5107 18.048 10.5875 12.065 10.5875C6.09081 10.5875 1.23315 14.5116 1.23315 18.7326C1.23315 19.7949 1.53975 20.7996 2.09002 21.7104C3.73376 20.4337 7.58657 19.5335 12.065 19.5326Z" fill="#CBECFC"/>
            <path d="M12.0654 19.5612C16.5483 19.5612 20.3922 20.4552 22.0306 21.7213C22.5809 20.8175 22.8884 19.8199 22.8884 18.7691C22.8884 14.5774 18.0405 10.6798 12.0654 10.6798C6.09926 10.6798 1.2478 14.5791 1.2478 18.7673C1.2478 19.8217 1.5544 20.8175 2.10379 21.7222C3.74486 20.4552 7.59324 19.5621 12.0654 19.5612Z" fill="#D0EEFC"/>
            <path d="M12.0654 19.5903C16.5421 19.5903 20.3807 20.4772 22.0156 21.7336C22.5667 20.8369 22.8742 19.8481 22.8742 18.8053C22.8742 14.6446 18.0307 10.7736 12.0654 10.7736C6.10721 10.7736 1.26373 14.6464 1.26373 18.8027C1.26373 19.849 1.56944 20.8378 2.11706 21.7354C3.75636 20.4772 7.59854 19.5912 12.0654 19.5903Z" fill="#D6F0FC"/>
            <path d="M12.065 19.6194C16.5354 19.6194 20.3696 20.5001 22.0018 21.7458C22.5512 20.8562 22.8587 19.8754 22.8587 18.8406C22.8587 14.7117 18.0232 10.8664 12.065 10.8664C6.11473 10.8664 1.27834 14.7135 1.27834 18.8379C1.27834 19.8772 1.58316 20.8571 2.13077 21.7476C3.76742 20.5001 7.60516 19.6211 12.065 19.6194Z" fill="#DBF2FD"/>
            <path d="M12.0654 19.6482C16.5288 19.6482 20.3585 20.5227 21.9881 21.7587C22.5357 20.8754 22.8432 19.9025 22.8432 18.8756C22.8432 14.7787 18.0148 10.9591 12.0654 10.9591C6.12319 10.9591 1.29388 14.7805 1.29388 18.873C1.29388 19.9043 1.59871 20.8763 2.14455 21.7605C3.77854 20.5227 7.61097 19.65 12.0654 19.6482Z" fill="#E1F3FD"/>
            <path d="M12.0654 19.6778C16.5226 19.6778 20.3461 20.5452 21.9739 21.7714C22.5215 20.8952 22.8281 19.9294 22.8281 18.9114C22.8281 14.8455 18.0059 11.0524 12.0654 11.0524C6.13114 11.0524 1.30893 14.8481 1.30893 18.9087C1.30893 19.9321 1.61375 20.896 2.15871 21.7732C3.79004 20.5452 7.61715 19.6795 12.0654 19.6778Z" fill="#E7F6FD"/>
            <path d="M12.0655 19.7067C16.5164 19.7067 20.3355 20.567 21.9606 21.7844C22.5065 20.9143 22.8131 19.9574 22.8131 18.9465C22.8131 14.9125 17.9971 11.146 12.0655 11.146C6.13914 11.146 1.32402 14.9151 1.32402 18.9438C1.32402 19.9592 1.62796 20.9152 2.17291 21.7861C3.80159 20.567 7.62338 19.7084 12.0655 19.7067Z" fill="#ECF8FE"/>
            <path d="M12.0654 19.7358C16.5102 19.7358 20.3231 20.5899 21.9456 21.7967C22.4914 20.9346 22.798 19.9848 22.798 18.9818C22.798 14.9797 17.9891 11.2389 12.0654 11.2389C6.1471 11.2389 1.33907 14.9823 1.33907 18.9791C1.33907 19.9865 1.643 20.9346 2.18619 21.7993C3.81309 20.5899 7.63045 19.7376 12.0654 19.7358Z" fill="#F1FAFE"/>
            <path d="M12.0654 19.7651C16.5039 19.7651 20.3124 20.6121 21.9322 21.8091C22.4763 20.9532 22.7829 20.0114 22.7829 19.0173C22.7829 15.0471 17.9802 11.332 12.0654 11.332C6.15593 11.332 1.3541 15.0488 1.3541 19.0146C1.3541 20.014 1.65715 20.9532 2.20033 21.8118C3.82457 20.6121 7.63573 19.766 12.0654 19.7651Z" fill="#F7FCFF"/>
            <path d="M12.0654 19.7939C16.4978 19.7939 20.3001 20.6347 21.9181 21.822C22.4613 20.9723 22.7679 20.0384 22.7679 19.0523C22.7679 15.114 17.9723 11.4255 12.0654 11.4255C6.16395 11.4255 1.3692 15.1157 1.3692 19.0496C1.3692 20.0411 1.67225 20.9723 2.21367 21.8237C3.83525 20.6347 7.64286 19.7956 12.0654 19.7939Z" fill="white"/>
            </g>
            <path d="M11.9992 15.83C8.12539 15.83 4.52951 16.4886 1.56482 17.603C3.34682 21.5897 7.34283 24.3682 12.001 24.3682C16.6494 24.3682 20.6419 21.5879 22.4301 17.603C19.4636 16.4886 15.8651 15.83 11.9992 15.83Z" fill="#0088CC"/>
        </svg>
            `;

	// 채팅 아이콘 클릭 이벤트
	chatIcon.addEventListener("click", function () {
		chatWindow.classList.toggle("hidden");
	});

	// 닫기 버튼 클릭 이벤트
	closeChat.addEventListener("click", function () {
		chatWindow.classList.add("hidden");
	});

	// 메시지 전송 이벤트
	chatForm.addEventListener("submit", async function (e) {
		e.preventDefault();
		const message = messageInput.value.trim();
		if (!message) return;

		// 사용자 메시지 표시
		appendMessage(message, true);
		messageInput.value = "";

		try {
			const response = await fetch("/chatbot/send/", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
					"X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value,
				},
				body: JSON.stringify({
					message: message,
					isPowerMode: powerModeToggle.checked,
				}),
			});

			if (!response.ok) throw new Error("Network response was not ok");

			const data = await response.json();

			console.log("like_count값이 있나 ?", data.like_count);  // 디버깅

			appendMessage(data.response, false, data.message_id);
		} catch (error) {
			console.error("Error:", error);
			appendMessage("죄송합니다. 오류가 발생했습니다.", false);
		}
	});

	// 메시지 추가 함수
	function appendMessage(message, isUser, messageId) {
		if (isUser) {
			const messageHTML = createUserMessage(message);
			chatMessages.insertAdjacentHTML("beforeend", messageHTML);
		} else {
			createBotMessage(message, messageId); // 직접 DOM에 삽입
		}
		chatMessages.scrollTop = chatMessages.scrollHeight;
	}

	// 챗봇 메시지 생성 함수 수정
	function createBotMessage(message, messageId) {
	
		// 컨테이너 요소 생성
		const container = document.createElement('div');
		container.className = 'flex items-start mb-4';
		container.setAttribute('data-message-id', messageId); // 메시지 ID 설정

		// Bot Icon 섹션
		const iconWrapper = document.createElement('div');
		iconWrapper.className = 'flex-shrink-0 rounded-full p-1 mr-3';
		iconWrapper.innerHTML = BOT_ICON;

		// 메시지 섹션
		const messageWrapper = document.createElement('div');
		messageWrapper.className = 'flex-1 bg-gray-100 rounded-lg p-3 relative';
		messageWrapper.innerHTML = `<p>${message}</p>`;

		// 버튼 섹션
		const buttonContainer = document.createElement('div');
		buttonContainer.className = 'absolute bottom-2 right-2 flex gap-2';

		// 좋아요 버튼
		const likeButton = document.createElement('button');
		likeButton.className = 'like-button text-gray-500 hover:text-blue-500';
		likeButton.innerHTML = `
			<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
				<path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
			</svg>`;
		likeButton.addEventListener('click', () => handleLike(messageId, 1));

		// 싫어요 버튼
		const dislikeButton = document.createElement('button');
		dislikeButton.className = 'dislike-button text-gray-500 hover:text-red-500';
		dislikeButton.innerHTML = `
			<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
				<path d="M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667v-5.43a2 2 0 00-1.105-1.79l-.05-.025A4 4 0 0011.055 2H5.64a2 2 0 00-1.962 1.608l-1.2 6A2 2 0 004.44 12H8v4a2 2 0 002 2 1 1 0 001-1v-.667a4 4 0 01.8-2.4l1.4-1.866a4 4 0 00.8-2.4z" />
			</svg>`;
		dislikeButton.addEventListener('click', () => handleLike(messageId, -1));

		// 요소 조립
		buttonContainer.appendChild(likeButton);
		buttonContainer.appendChild(dislikeButton);
		messageWrapper.appendChild(buttonContainer);
		container.appendChild(iconWrapper);
		container.appendChild(messageWrapper);
		
		document.getElementById('chat-messages').appendChild(container);
	}

	// 사용자 메시지 생성 함수
	function createUserMessage(message) {
		return `
		<div class="flex items-start justify-end mb-4">
			<div class="flex-shrink-0 bg-blue-500 text-white rounded-lg p-3 ml-3">
				<p>${message}</p>
			</div>
		</div>`;
	}

	// 좋아요/싫어요 처리 함수 추가
	async function handleLike(messageId, value) {
		console.log('handleLike executed!', messageId, value); // 디버깅용
		console.log('/chatbot/like/');
		try {
			const response = await fetch('/chatbot/like/', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
				},
				body: JSON.stringify({
					message_id: messageId,
					like_value: value
				})
			});
			
			if (!response.ok) throw new Error('Network response was not ok');

			console.log(response)

			const data = await response.json();
			
			// 버튼 UI 업데이트
			updateLikeUI(messageId, value);

		} catch (error) {
			console.error('Error:', error);
		}
	}

	// 좋아요/싫어요 UI 업데이트 함수
	function updateLikeUI(messageId, value) {
		// 메시지 ID를 기준으로 해당 버튼들을 찾아옵니다
		const messageContainer = document.querySelector(`[data-message-id="${messageId}"]`);
		if (!messageContainer) {
			console.error(`Message with ID ${messageId} not found.`);
			return;
		}

		// 버튼 요소들 찾기
		const likeButton = messageContainer.querySelector('.like-button');
		const dislikeButton = messageContainer.querySelector('.dislike-button');

		// 활성화 상태 초기화
		likeButton.classList.remove('text-blue-500');
		likeButton.classList.add('text-gray-500');
		dislikeButton.classList.remove('text-red-500');
		dislikeButton.classList.add('text-gray-500');

		// 누른 버튼 활성화
		if (value === 1) {
			likeButton.classList.remove('text-gray-500');
			likeButton.classList.add('text-blue-500'); // 활성화된 색상으로 변경
		} else if (value === -1) {
			dislikeButton.classList.remove('text-gray-500');
			dislikeButton.classList.add('text-red-500'); // 활성화된 색상으로 변경
		}
	}
});
